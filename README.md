# MalussBit

MalussBit는 micro:bit v2와 서보모터, 내장 조도 센서를 이용해 말루스의 법칙(Malus' law)을 손쉽게 측정·시각화하는 최소 구성 웹앱입니다. MagnetometerBit 프로젝트의 정적 자산을 재사용하면서, 단일 스윕으로 데이터를 수집하고 cos² 피팅 결과를 바로 확인할 수 있도록 단순화했습니다.

## 주요 기능
- **원클릭 스윕**: 장치를 연결한 뒤 `스윕 실행` 버튼을 누르면 0°→180° 범위를 자동으로 측정하고 결과를 기록합니다. 스윕이 끝나거나 `RESET` 명령을 받으면 펌웨어가 `END` 신호를 보내고 버튼이 다시 활성화됩니다.
- **Malus 곡선 피팅**: 수집된 각도/조도 데이터를 cos² 모델에 자동으로 적합하고 진폭(A), 오프셋(B), 위상(φ₀), R²를 표시합니다. 필요 시 버튼으로 재실행할 수 있습니다.
- **Mock 텔레메트리**: `?mock=1` 파라미터로 접속하면 장치 없이도 동일한 데이터 스트림을 재현해 UI 흐름과 피팅 로직을 확인할 수 있습니다.
- **데이터 관리**: 실시간 산점도와 최근 로그, CSV 다운로드를 통해 실험 데이터를 저장할 수 있습니다.

## 사용 방법
1. micro:bit에 제공된 `firmware/v1.0-mal.js` 코드를 MakeCode에서 플래시합니다. 펌웨어는 `SWEEP` 명령을 받으면 0°→180°로 스윕한 뒤 0° 위치로 복귀하고, 종료 시 `END` 문자열을 전송합니다. `RESET`/`STOP` 명령을 받으면 즉시 루프를 중단하고 초기 위치 및 상태로 돌아갑니다.
2. 웹앱은 GitHub Pages로 배포된 <https://cho-wh.github.io/MalussBit/> 에서 바로 사용할 수 있습니다. HTTPS 페이지이므로 별도 설정 없이 Web Bluetooth를 사용할 수 있으며, 필요 시 로컬에서도 `http://localhost`로 서빙해 사용할 수 있습니다.
3. 페이지를 열고 **디바이스 연결** 버튼으로 micro:bit를 페어링합니다. 연결이 완료되면 웹앱이 자동으로 RESET 명령을 보내 초기 상태를 맞춥니다.
4. 연결이 유지되는 동안 **스윕 실행** 버튼은 한 번만 활성화됩니다. 스윕이 시작되면 버튼이 잠기고, 펌웨어의 `END` 신호를 받거나 연결이 끊기면 다시 `idle` 상태로 전환되어 재시도할 수 있습니다.
5. 필요 시 **RESET** 버튼을 눌러 장치·웹앱 상태를 즉시 초기화합니다. 스윕이 도중에 중단되거나 각도가 꼬여도 RESET 후 바로 재측정이 가능합니다.
6. 데이터가 쌓이면 `CSV 다운로드` 버튼으로 누적 데이터를 저장할 수 있습니다.

## Mock 모드
- `index.html?mock=1`로 접속하면 내부 시뮬레이터가 0→180° 스윕 데이터를 생성합니다.
- 실제 장치 없이도 그래프, 로그, 피팅 결과 등을 검증할 수 있으며, `스윕 실행` 버튼을 반복해 다양한 데이터를 만들어 볼 수 있습니다.

## 참고 사항
- 펌웨어는 각 샘플과 함께 스윕 종료 시 `END` 메시지를 보냅니다. 웹앱은 이를 받아 버튼 상태를 복원하고 오류 메시지를 지웁니다.
- CSV 포맷은 `timestamp,angle_cmd,illuminance`이며, 타임스탬프는 웹앱 수신 시간을 기준으로 ISO 문자열로 저장됩니다.
- 향후 작업: 스윕 타임아웃 감지, 실제 장치 테스트 체크리스트 정리, 교사용 보조 UI 설계(반복 스윕·노트), 문서 보강.
