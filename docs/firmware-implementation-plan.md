# MalussBit micro:bit Firmware 구현 계획 (간소화 버전)

## 1. 목표 및 범위
- micro:bit v2, 서보모터, 온보드 조도 센서를 이용해 말루스 법칙 실험 데이터를 최소 구성으로 수집한다.
- 웹앱은 `SWEEP` 명령을 보내 단 한 번의 0→180° 스윕을 수행하며, 펌웨어는 각도·조도 샘플을 UART 텍스트로 전송한다.
- MakeCode JavaScript 블록과 호환되는 단순 구조를 유지한다.

## 2. 필수 기능
### 2.1 초기화
- 서보모터 핀: P1 (`servos.P1`).
- `bluetooth.startUartService()` 호출 후 서보를 0° 위치로 이동.
- 별도 상태 메시지는 전송하지 않는다.

### 2.2 명령 처리
- UART 개행 기준으로 문자열을 읽고 공백 제거 후 대문자로 비교한다.
- 지원 명령:
  - `SWEEP`: 0→180° 범위를 1° 단위로 이동하며 샘플 전송. 완료 후 서보를 0°로 복귀.
  - `RESET`, `STOP`: 진행 중 여부와 관계없이 서보를 0°로 이동.
- 그 외 명령은 무시한다.

### 2.3 스윕 루프
- 각 단계에서 `servos.P1.setAngle(angle)` 호출 후 조도(`input.lightLevel()`)를 읽어 전송한다.
- 전송 포맷: `timestamp_ms,angle_cmd,light` (CSV).
- 각 스텝 간격은 50 ms (`basic.pause(50)`).
- 스윕 종료 시 추가 상태 메시지를 보내지 않는다.

### 2.4 통신 포맷
- 데이터 샘플만 송신하며 상태 메시지(`MSG:`)는 사용하지 않는다.
- `timestamp_ms`는 `control.millis()`를 사용하고, 각도는 정수(0–180°)로 보낸다.

## 3. 안전 장치
- 각도는 항상 0–180° 범위에서 설정한다.
- Bluetooth 연결이 끊긴 경우 별도 처리는 하지 않지만, 웹앱이 재연결 후 `RESET`을 호출한다.

## 4. 구현 체크리스트
1. UART 서비스 시작 및 데이터 수신 핸들러 등록.
2. `SWEEP` 구현: for 루프(0→180°)와 50 ms 간격, 각도/조도 샘플 전송.
3. `RESET`/`STOP`: 즉시 0° 이동.
4. MakeCode 블록 호환성을 위해 전역 변수 초기화는 `setup()` 내에서 수행.
5. 실제 장비에서 스윕 명령을 보내어 각도/조도 데이터가 안정적으로 수신되는지 확인.

## 5. 향후 확장 고려
- 반복 스윕, 각도 범위 조절 등은 향후 `CONFIG` 명령을 도입할 때 별도 분기 처리.
- 상태 메시지가 필요해질 경우 웹앱과 사전에 메시지 포맷을 합의한 뒤 추가한다.
