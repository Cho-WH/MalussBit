# Firmware README

- 이 디렉터리에는 기존 MagnetometerBit 프로젝트의 펌웨어 스크립트를 참고용으로 보관합니다.
- MicroBit을 위한 firmware를 js 코드로 작성합니다. 이 코드는 makecode에서 기기에 플래시 될 예정입니다.

## 디렉터리 보관 파일

### Reference
- `v1.1-mg-reference.js`: MagnetometerBit v1.1 펌웨어 사본. 구조와 BLE UART 포맷을 파악하기 위한 자료.
- `v6-reference.js`: v1.1을 작성할 때도 참고 했던 원조 펌웨어
>  **주의:**  이 파일은 바로 사용 가능한 MalussBit 펌웨어가 아닙니다. 서보 구동 및 조도 센서 데이터 스트림에 맞춘 새 펌웨어를 작성할 때 참조용으로만 활용하세요.

### 프로젝트 펌웨어
- `v1.0-mal.js`: MalussBit 전용 서보/조도 제어 로직.

## mal 펌웨어 로직 설명 (`v1.0-mal.js`)

### 1. 기본 설정
- 스윕 각도는 0°에서 180°까지 고정되어 있으며, 각 스텝마다 1°씩 증가합니다.
- 샘플 간격은 50 ms로 설정되어 있습니다.
- 서보는 `servos.P1`에 연결되어 있으며, 초기화 시 0°로 이동합니다.

### 2. 명령 처리
- BLE UART로 수신한 문자열을 줄 단위로 읽고, 공백을 제거한 뒤 대문자로 비교합니다.
- `SWEEP`: 즉시 0° → 180°까지 순차적으로 스윕을 수행하며 매 각도마다 데이터 샘플을 전송합니다. 스윕이 끝나면 서보를 다시 0°로 이동합니다.
- `RESET` 또는 `STOP`: 스윕 중 여부와 상관없이 서보를 0°로 이동시킵니다.
- 그 외 명령은 무시합니다.

### 3. 데이터 전송 포맷
- 각 스윕 스텝마다 `timestamp_ms,angle_cmd,,light` 형식의 CSV 문자열을 BLE UART로 전송합니다.
  - `timestamp_ms`: `control.millis()` 값을 사용합니다.
  - `angle_cmd`: 현재 서보에 지시한 각도(정수, 0–180°).
  - `light`: `input.lightLevel()`로 읽은 조도 센서 값.
  - 세 번째 필드는 향후 각도 추정값 확장을 위해 비워 둡니다.

### 4. 동작 요약
- 첫 번째 스윕 명령이 들어오면 별도의 상태 플래그 없이 즉시 전 범위를 스윕합니다.
- 모든 명령 처리 후 서보는 항상 0° 위치로 복귀하여 다음 명령을 기다립니다.
- 상태 메시지나 오류 코드 등 추가적인 BLE 응답은 전송하지 않으며, 웹앱은 샘플 스트림만 사용합니다.
